name: Build APK

on: [pull_request]

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v3

      - name: Setup Flutter
        uses: subosito/flutter-action@v2
        with:
          flutter-version: '3.32.5'

      - name: Install melos
        run: dart pub global activate melos

      - name: Install dependencies
        run: melos pub:get

      - name: Flutter gen l10n
        run: flutter gen-l10n

      - name: Build APK
        run:
          cd easy_task_app && flutter build apk --debug --dart-define=SUPABASE_URL=https://nzjojzchnyihkehntoxw.supabase.co --dart-define=SUPABASE_API_KEY=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im56am9qemNobnlpaGtlaG50b3h3Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTM1MjM3MjYsImV4cCI6MjA2OTA5OTcyNn0.Ned5voI11QDLjinkMgw00Gb3jMi731_cXr_IBAmkdCs

      - name: Upload APK artifact
        uses: actions/upload-artifact@v4
        with:
          name: app-debug.apk
          path: easy_task_app/build/app/outputs/flutter-apk/app-debug.apk